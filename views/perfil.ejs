<%- include('partials/header', { titulo: 'Meu Perfil - Portal Pedro II' }) %>

<main style="max-width: 500px; margin: 4rem auto; padding: 0 1rem;">
    <div class="form-card" style="padding: 2.5rem;">
        
        <div style="text-align: center; margin-bottom: 2rem;">
            <div style="width: 80px; height: 80px; background-color: var(--cor-primaria-clara); color: var(--cor-primaria); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin: 0 auto 1rem auto;">
                ğŸ‘¤
            </div>
            <h2 style="color: var(--cor-primaria); margin: 0;">Meu Perfil</h2>
            <p style="color: var(--texto-leve); font-size: 0.9rem; margin-top: 0.5rem;">
                Seus dados ficam salvos apenas neste navegador para agilizar o envio de sugestÃµes.
            </p>
        </div>

        <form id="formPerfil">
            <label for="nomeSalvo">Seu Nome:</label>
            <input type="text" id="nomeSalvo" placeholder="Ex: JoÃ£o da Silva">

            <label for="emailSalvo">Seu E-mail:</label>
            <input type="email" id="emailSalvo" placeholder="joao@exemplo.com">

            <label for="cidadeSalva">Sua Cidade:</label>
            <input type="text" id="cidadeSalva" placeholder="Ex: Pedro II">

            <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
                <button type="submit" class="btn btn-enviar" style="flex: 2;">ğŸ’¾ Salvar PreferÃªncias</button>
                <button type="button" id="btnLimpar" class="btn btn-cancelar" style="flex: 1;">ğŸ—‘ï¸ Limpar</button>
            </div>
        </form>

    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const nome = document.getElementById('nomeSalvo');
        const email = document.getElementById('emailSalvo');
        const cidade = document.getElementById('cidadeSalva');
        const btnLimpar = document.getElementById('btnLimpar');

        // 1. CARREGAR DADOS SALVOS (Ao abrir a pÃ¡gina)
        const perfilSalvo = JSON.parse(localStorage.getItem('perfil_visitante')) || {};
        
        if (perfilSalvo.nome) nome.value = perfilSalvo.nome;
        if (perfilSalvo.email) email.value = perfilSalvo.email;
        if (perfilSalvo.cidade) cidade.value = perfilSalvo.cidade;

        // 2. SALVAR DADOS
        document.getElementById('formPerfil').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const dados = {
                nome: nome.value,
                email: email.value,
                cidade: cidade.value
            };

            // Salva no navegador do usuÃ¡rio
            localStorage.setItem('perfil_visitante', JSON.stringify(dados));
            
            Swal.fire({
                title: 'Salvo!',
                text: 'Seus dados serÃ£o usados para preencher formulÃ¡rios automaticamente.',
                icon: 'success',
                timer: 2000,
                showConfirmButton: false
            });
        });

        // 3. LIMPAR DADOS
        btnLimpar.addEventListener('click', () => {
            Swal.fire({
                title: 'Tem certeza?',
                text: 'Isso apagarÃ¡ seus dados salvos neste navegador.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: 'Sim, limpar'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.removeItem('perfil_visitante');
                    nome.value = '';
                    email.value = '';
                    cidade.value = '';
                    Swal.fire('Limpo!', '', 'success');
                }
            });
        });
    });
</script>

<%- include('partials/footer') %>
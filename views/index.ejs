<%- include('partials/header', { titulo: 'In√≠cio - Portal Pedro II' }) %>

<style>
    /* --- Estilos exclusivos da Home --- */
    
    /* CARROSSEL HERO (Substitui a antiga .hero-section) */
    .hero-carousel {
        position: relative;
        max-width: 100%;
        margin-bottom: 2rem;
        border-radius: 0 0 24px 24px;
        overflow: hidden; /* Garante que nada saia das bordas arredondadas */
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        background: #1a202c; /* Fundo base para carregamento */
    }

    /* Os Slides (T√™m o mesmo tamanho e estilo) */
    .carousel-slide {
        display: none; /* Esconde todos por padr√£o */
        padding: 6rem 1.5rem; /* Altura generosa */
        text-align: center;
        background-size: cover;
        background-position: center;
        /* Efeito de fade suave ao trocar */
        animation: fadeEffect 1.0s;
        min-height: 450px; /* Garante altura igual para todos */
        
        /* Flexbox para centralizar conte√∫do */
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    /* O slide ativo aparece */
    .carousel-slide.ativo {
        display: flex; 
    }

    @keyframes fadeEffect {
        from {opacity: 0.4}
        to {opacity: 1}
    }

    /* --- SLIDE 1: BOAS VINDAS (Estilo Original) --- */
    .slide-boas-vindas {
        background: linear-gradient(rgba(15, 76, 129, 0.85), rgba(15, 76, 129, 0.7)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/Morro_do_Gritador.jpg/1200px-Morro_do_Gritador.jpg');
        background-size: cover;
        background-position: center;
    }

    .slide-boas-vindas h1 {
        font-size: 2.8rem;
        margin-bottom: 1rem;
        color: white;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .slide-boas-vindas p {
        font-size: 1.25rem;
        color: rgba(255,255,255, 0.95);
        max-width: 700px;
        margin: 0 auto 2rem auto;
    }

    /* --- SLIDES DE BANNER (Publicidade) --- */
    .slide-banner {
        position: relative;
        text-decoration: none; /* Remove sublinhado se for link */
    }
    
    /* Gradiente escuro embaixo para o texto aparecer */
    .banner-overlay {
        background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 4rem 1.5rem 2rem 1.5rem;
        text-align: center;
    }

    .slide-banner h2 {
        color: white;
        font-size: 2.5rem;
        margin: 0;
        text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }
    
    .tag-patrocinio {
        background: var(--cor-destaque);
        color: #000;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 10px;
        display: inline-block;
    }

    /* --- INDICADORES (Bolinhas) --- */
    .carousel-dots {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 10;
    }

    .dot {
        height: 12px;
        width: 12px;
        background-color: rgba(255,255,255,0.4);
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s;
    }

    .dot.ativo {
        background-color: white;
        transform: scale(1.2);
    }

    /* Widget de Clima (Mantido do original) */
    .widget-clima {
        display: inline-flex;
        align-items: center;
        gap: 12px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
        padding: 8px 20px;
        border-radius: 50px;
        margin-top: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        font-weight: 500;
    }

    /* --- Resto dos estilos da Grid (Mantidos) --- */
    .grid-home {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 1.5rem;
    }

    .card-home {
        background-color: var(--bg-card);
        border: 1px solid var(--borda-suave);
        border-radius: 16px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    /* ... (O restante dos estilos da grid pode manter igual) ... */
</style>

<section class="hero-carousel">
    
    <div class="carousel-slide slide-boas-vindas ativo">
        <div class="container">
            <h1>Bem-vindo a Pedro II</h1>
            <p>A Su√≠√ßa Piauiense espera por voc√™. Descubra festivais, belezas naturais e a nossa preciosa opala.</p>
            
            <div style="margin-top: 1rem; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <a href="/mapa" class="btn" style="background: white; color: var(--cor-primaria);">üó∫Ô∏è Ver Mapa</a>
                <a href="/estabelecimentos" class="btn" style="border: 2px solid white; color: white;">üè® Onde Ficar</a>
            </div>

            <div class="widget-clima">
                <span id="climaIcone" style="font-size: 1.5rem;">üå§Ô∏è</span>
                <div style="text-align: left; line-height: 1.2;">
                    <span id="climaTemp" style="font-size: 1.2rem; font-weight: bold; display: block;">--¬∞C</span>
                    <span id="climaTexto" style="font-size: 0.8rem; opacity: 0.9;">Carregando...</span>
                </div>
            </div>
        </div>
    </div>

    <% if (banners && banners.length > 0) { %>
        <% banners.forEach(banner => { %>
            <<%= banner.link ? 'a href=' + banner.link + ' target="_blank"' : 'div' %> 
                class="carousel-slide slide-banner" 
                style="background-image: url('<%= banner.imagem %>');">
                
                <% if(banner.titulo) { %>
                    <div class="banner-overlay">
                        <span class="tag-patrocinio">Publicidade</span>
                        <h2><%= banner.titulo %></h2>
                    </div>
                <% } %>
            </<%= banner.link ? 'a' : 'div' %>>
        <% }) %>
    <% } %>

    <div class="carousel-dots" id="carouselDots">
        </div>

</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        let slideIndex = 0;
        const slides = document.getElementsByClassName("carousel-slide");
        const dotsContainer = document.getElementById("carouselDots");
        let timer;

        // 1. Criar as bolinhas dinamicamente
        if(slides.length > 1) {
            for(let i=0; i<slides.length; i++) {
                const dot = document.createElement("span");
                dot.className = "dot";
                dot.onclick = () => mudarSlideManual(i);
                dotsContainer.appendChild(dot);
            }
            atualizarDots();
        }

        // 2. Iniciar rota√ß√£o autom√°tica
        iniciarTimer();

        function iniciarTimer() {
            if(slides.length > 1) {
                timer = setInterval(proximoSlide, 5000); // Muda a cada 5 segundos
            }
        }

        function proximoSlide() {
            slideIndex++;
            if (slideIndex >= slides.length) { slideIndex = 0; }
            mostrarSlide(slideIndex);
        }

        function mudarSlideManual(n) {
            clearInterval(timer); // Para o timer ao clicar
            slideIndex = n;
            mostrarSlide(slideIndex);
            iniciarTimer(); // Reinicia
        }

        function mostrarSlide(n) {
            // Esconde todos
            for (let i = 0; i < slides.length; i++) {
                slides[i].classList.remove("ativo");
            }
            // Mostra o atual
            slides[n].classList.add("ativo");
            atualizarDots();
        }

        function atualizarDots() {
            const dots = document.getElementsByClassName("dot");
            if(dots.length === 0) return;
            
            for (let i = 0; i < dots.length; i++) {
                dots[i].classList.remove("ativo");
            }
            dots[slideIndex].classList.add("ativo");
        }
    });
</script>

<section style="max-width: 1200px; margin: -2rem auto 3rem auto; padding: 0 1rem; position: relative; z-index: 10;">
    <h3 style="text-align: center; color: var(--texto-titulo); margin-bottom: 1.5rem; font-size: 1.2rem; opacity: 0.8;">
        ‚ú® Escolha sua experi√™ncia hoje
    </h3>

    <div class="grid-vibes" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
        
        <a href="/estabelecimentos?busca=joia" class="card-vibe" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('https://upload.wikimedia.org/wikipedia/commons/e/e3/Opala_Pedro_II.jpg');">
            <div class="vibe-content">
                <span style="font-size: 2rem;">üíé</span>
                <h4>Rota da Opala</h4>
                <p>Joalherias e Minas</p>
            </div>
        </a>

        <a href="/estabelecimentos?filtro=turismo" class="card-vibe" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/Morro_do_Gritador.jpg/800px-Morro_do_Gritador.jpg');">
            <div class="vibe-content">
                <span style="font-size: 2rem;">üåø</span>
                <h4>Natureza</h4>
                <p>Cachoeiras e Trilhas</p>
            </div>
        </a>

        <a href="/estabelecimentos?filtro=gastronomia" class="card-vibe" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('https://dynamic-media-cdn.tripadvisor.com/media/photo-o/13/64/73/0c/fachada.jpg?w=700&h=-1&s=1');">
            <div class="vibe-content">
                <span style="font-size: 2rem;">üç∑</span>
                <h4>Gastronomia</h4>
                <p>Bares e Restaurantes</p>
            </div>
        </a>

    </div>
</section>

<style>
    /* CSS exclusivo para as Vibes */
    .card-vibe {
        height: 180px;
        border-radius: 16px;
        background-size: cover;
        background-position: center;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        text-decoration: none;
        color: white;
        transition: transform 0.3s, box-shadow 0.3s;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        border: 2px solid white;
    }
    
    .card-vibe:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 10px 20px rgba(0,0,0,0.25);
        border-color: var(--cor-destaque);
    }

    .vibe-content h4 {
        margin: 5px 0 0 0;
        font-size: 1.4rem;
        font-weight: bold;
        text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    }

    .vibe-content p {
        margin: 0;
        font-size: 0.9rem;
        opacity: 0.9;
        text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }
</style>

<style>
    /* --- Estilos exclusivos da Home --- */
    
    /* Banner Hero (Topo) */
    .hero-section {
        background: linear-gradient(135deg, var(--cor-primaria) 0%, #2a4365 100%);
        color: white;
        padding: 4rem 1.5rem;
        text-align: center;
        margin-bottom: 2rem;
        border-radius: 0 0 20px 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .hero-section h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: white; /* For√ßa branco mesmo no dark mode */
    }

    .hero-section p {
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto;
        opacity: 0.9;
        color: #e2e8f0;
    }

    /* Grid Responsivo para Home */
    .grid-home {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 1.5rem;
    }

    /* Ajustes nos Cards da Home */
    .card-home {
        background-color: var(--bg-card);
        border: 1px solid var(--borda-suave);
        border-radius: 16px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .card-home:hover {
        transform: translateY(-5px);
        box-shadow: var(--sombra-card);
        border-color: var(--cor-primaria);
    }

    .card-img-top {
        height: 200px;
        background-size: cover;
        background-position: center;
        background-color: #eee;
    }

    .card-body {
        padding: 1.5rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    .secao-home {
        padding: 2rem 0;
        margin-bottom: 2rem;
    }

    /* Badges */
    .badge-data {
        background: var(--cor-primaria-clara);
        color: var(--cor-primaria);
        padding: 4px 10px;
        border-radius: 6px;
        font-weight: bold;
        font-size: 0.85rem;
        display: inline-block;
        margin-bottom: 10px;
    }

    .badge-destaque {
        color: var(--cor-destaque);
        font-weight: bold;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 5px;
        margin-bottom: 5px;
    }

    .widget-clima {
        display: inline-flex;
        align-items: center;
        gap: 12px;
        background: rgba(255, 255, 255, 0.15); /* Vidro transl√∫cido */
        backdrop-filter: blur(5px);
        padding: 8px 20px;
        border-radius: 50px;
        margin-top: 2rem; /* Separar dos bot√µes */
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        font-weight: 500;
        animation: fadeIn 1s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>

<main>

    <section class="secao-home">
        <div style="display: flex; justify-content: space-between; align-items: end; margin-bottom: 1rem;">
            <div>
                <h2>üìÖ Pr√≥ximos Eventos</h2>
                <p style="color: var(--texto-leve); margin: 0;">Fique por dentro da agenda cultural.</p>
            </div>
            <a href="/eventos" style="color: var(--cor-primaria); font-weight: 600; text-decoration: none;">Ver tudo ‚Üí</a>
        </div>

        <div class="grid-home">
            <% if (!eventos || eventos.length === 0) { %>
                <div style="grid-column: 1/-1; text-align: center; padding: 2rem; background: var(--bg-card); border-radius: 12px; border: 1px dashed var(--borda-suave);">
                    <p style="color: var(--texto-leve);">Nenhum evento pr√≥ximo agendado no momento.</p>
                </div>
            <% } else { %>
                <% eventos.forEach(ev => { %>
                    <article class="card-home">
                        <div class="card-img-top" style="background-image: url('<%= ev.imagem || '/img/placeholder.jpg' %>');"></div>
                        
                        <div class="card-body">
                            <div>
                                <span class="badge-data">
                                    üìÖ <%= new Date(ev.data).toLocaleDateString('pt-BR', {timeZone: 'UTC'}) %>
                                </span>
                            </div>
                            
                            <h3 style="margin: 10px 0; font-size: 1.25rem; color: var(--texto-titulo);"><%= ev.nome %></h3>
                            <p style="color: var(--texto-leve); font-size: 0.95rem; margin-bottom: 1.5rem;">
                                üìç <%= ev.local %>
                            </p>
                            
                            <a href="/detalhe?tipo=evento&id=<%= ev.id %>" class="btn btn-primary" style="margin-top: auto; text-align: center;">
                                Detalhes
                            </a>
                        </div>
                    </article>
                <% }) %>
            <% } %>
        </div>
    </section>

    <hr style="border: 0; border-top: 1px solid var(--borda-suave); margin: 3rem 0;">

    <section class="secao-home">
        <div style="display: flex; justify-content: space-between; align-items: end; margin-bottom: 1rem;">
            <div>
                <h2>‚≠ê Destaques da Cidade</h2>
                <p style="color: var(--texto-leve); margin: 0;">Lugares recomendados para visitar.</p>
            </div>
            <a href="/estabelecimentos" style="color: var(--cor-primaria); font-weight: 600; text-decoration: none;">Ver todos ‚Üí</a>
        </div>

        <div class="grid-home">
            <% if (!destaques || destaques.length === 0) { %>
                <div style="grid-column: 1/-1; text-align: center; padding: 2rem; background: var(--bg-card); border-radius: 12px; border: 1px dashed var(--borda-suave);">
                    <p style="color: var(--texto-leve);">Nenhum destaque cadastrado ainda.</p>
                </div>
            <% } else { %>
                <% destaques.forEach(local => { %>
                    <article class="card-home">
                        <div class="card-img-top" style="background-image: url('<%= local.imagem || '/img/placeholder.jpg' %>');"></div>
                        
                        <div class="card-body">
                            <div class="badge-destaque">
                                <span>‚≠ê RECOMENDADO</span>
                            </div>
                            
                            <h3 style="margin: 5px 0; font-size: 1.25rem; color: var(--texto-titulo);"><%= local.nome %></h3>
                            <span style="background: #eee; color: #555; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; text-transform: uppercase; font-weight: 600; width: fit-content;">
                                <%= local.categoria %>
                            </span>
                            
                            <p style="color: var(--texto-corpo); font-size: 0.95rem; margin-top: 1rem; flex-grow: 1;">
                                <%= local.descricao ? local.descricao.substring(0, 80) + '...' : 'Venha conhecer este local incr√≠vel.' %>
                            </p>
                            
                            <a href="/detalhe?tipo=estabelecimento&id=<%= local.id %>" class="btn" style="margin-top: 1rem; text-align: center; border: 1px solid var(--borda-suave); color: var(--texto-corpo);">
                                Conhecer
                            </a>
                        </div>
                    </article>
                <% }) %>
            <% } %>
        </div>
    </section>

</main>

</main> <script src="/js/clima.js"></script> 

<%- include('partials/footer') %>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Publicidade</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="cabecalho-admin">
        <h2>Gest√£o de Publicidade</h2>
        <nav>
            <a href="/admin">In√≠cio</a>
            <a href="/admin/eventos">Eventos</a>
            <a href="/admin/estabelecimentos">Locais</a>
            <a href="/admin/transportes">Transportes</a>
            <a href="/admin/sugestoes">Sugest√µes</a> <a href="/logout" ...>Sair</a>
        </nav>
    </div>

    <main class="admin-container">
        <div class="form-card">
            <h3>Nova Publicidade</h3>
            <form id="formBanner" enctype="multipart/form-data">
                <label>Nome do Anunciante:</label>
                <input type="text" id="titulo" required placeholder="Ex: Pizzaria do Jo√£o">

                <label>Link de Destino (Instagram/Site):</label>
                <input type="text" id="link" required placeholder="https://instagram.com/...">

                <label>Imagem do Banner (Recomendado: Retangular):</label>
                <input type="file" id="imagemArquivo" accept="image/*" required>

                <button type="submit" class="btn btn-enviar" style="width: 100%; margin-top: 1rem;">Publicar An√∫ncio</button>
            </form>
        </div>

        <div class="lista-card">
            <h3>An√∫ncios Ativos</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 100px;">Banner</th>
                        <th>Anunciante</th>
                        <th>Link</th>
                        <th>A√ß√£o</th>
                    </tr>
                </thead>
                <tbody id="tabelaCorpo"></tbody>
            </table>
        </div>
    </main>

    <script>
        const form = document.getElementById('formBanner');
        const tabela = document.getElementById('tabelaCorpo');

        function carregar() {
            fetch('/api/banners')
                .then(res => res.json())
                .then(lista => {
                    tabela.innerHTML = '';
                    lista.forEach(b => {
                        tabela.innerHTML += `
                            <tr>
                                <td><img src="${b.imagem}" style="width:100px; height:auto; border-radius:4px;"></td>
                                <td>${b.titulo}</td>
                                <td><a href="${b.link}" target="_blank">Abrir Link</a></td>
                                <td><button class="btn-deletar" onclick="deletar(${b.id})">üóëÔ∏è</button></td>
                            </tr>`;
                    });
                });
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('titulo', document.getElementById('titulo').value);
            formData.append('link', document.getElementById('link').value);
            formData.append('imagem', document.getElementById('imagemArquivo').files[0]);

            const res = await fetch('/api/banners', { method: 'POST', body: formData });
            if(res.ok) { form.reset(); carregar(); } else { alert('Erro ao salvar'); }
        });

        window.deletar = (id) => {
            Swal.fire({
                title: 'Tem certeza?',
                text: "Voc√™ n√£o poder√° reverter essa a√ß√£o!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33', // Vermelho para perigo
                cancelButtonColor: '#004e92', // Azul para cancelar
                confirmButtonText: 'Sim, excluir!',
                cancelButtonText: 'Cancelar'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    // Se o usu√°rio clicou em "Sim", executa a exclus√£o
                    try {
                        await fetch(`/api/eventos/${id}`, { method: 'DELETE' });
                        
                        // Mostra sucesso e recarrega a tabela
                        Swal.fire(
                            'Deletado!',
                            'O evento foi removido.',
                            'success'
                        );
                        carregarEventos(); // Atualiza a lista na tela
                    } catch (error) {
                        Swal.fire('Erro!', 'N√£o foi poss√≠vel deletar.', 'error');
                    }
                }
            });
        };

        carregar();
    </script>
</body>
</html>